**WireGuard** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Å —Ü–µ–ª—å—é –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ. –ö–∞–∫ –∑–∞—è–≤–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –æ–Ω —á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è –±—ã—Å—Ç—Ä—ã–π –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–Ω –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –û–° —Å–µ–º–µ–π—Å—Ç–≤–∞ Linux, –Ω–æ –Ω–µ–º–Ω–æ–≥–∏–º –ø–æ–∑–∂–µ —Å—Ç–∞–ª –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–º. –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –µ–≥–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏ –ª–µ–≥–∫–∏–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏;
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏;
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç–æ–π–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–µ–π—à–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [WireGuard –Ω–∞ —Å–≤–æ–µ–º —Å–µ—Ä–≤–µ—Ä–µ: –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](https://timeweb.cloud/tutorials/network-security/wireguard-na-svoem-servere)
- [–í–∏–¥–µ–æ –ì–æ–ª–æ–±—É—Ä–¥–∏–Ω–∞](https://www.youtube.com/watch?v=5Aql0V-ta8A)

----
## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

–°–µ–π—á–∞—Å Wireguard —É–∂–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã.

–†–∞–±–æ—Ç–∞–µ—Ç Marzban. –ù–∞ –•–∞–±—Ä–µ –µ—Å—Ç—å —Å—Ç–∞—Ç—å—è –æ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –≥—É–≥–ª–∏—Ç–µ. –ï—Å–ª–∏ —Å—Ç–∞—Ç—å—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –±–µ–∑ VPN, –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –µ—ë –≤ startpage.com –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–º —Ä–µ–∂–∏–º–µ. –°—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é –Ω–µ –ø—Ä–∏–ª–∞–≥–∞—é, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å. –ì—É–≥–ª–∏—Ç—Å—è –ª–µ–≥–∫–æ.

–û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä:

```bash
apt update && apt upgrade -y
```

–°—Ç–∞–≤–∏–º wireguard:

```bash
apt install -y wireguard
```

–ì–µ–Ω–µ—Ä–∏–º –∫–ª—é—á–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
wg genkey | tee /etc/wireguard/privatekey | wg pubkey | tee /etc/wireguard/publickey
```

–ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á:

```bash
chmod 600 /etc/wireguard/privatekey
```

–ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫ —É –≤–∞—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```bash
ip a
```

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —É –≤–∞—Å —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `eth0`, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –∏ –¥—Ä—É–≥–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, `ens3` –∏–ª–∏ –∫–∞–∫-—Ç–æ –∏–Ω–∞—á–µ. –≠—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞–ª–µ–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ `/etc/wireguard/wg0.conf`, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–µ–π—á–∞—Å —Å–æ–∑–¥–∞–¥–∏–º:

```bash
vim /etc/wireguard/wg0.conf
```

```
[Interface]

PrivateKey = <privatekey>
Address = 10.0.0.1/24
ListenPort = 51830
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
```

–ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä [[vim]] ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª —Å `nano`, –æ–Ω –ø—Ä–æ—â–µ –≤ —Ä–∞–±–æ—Ç–µ.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ ‚Äî –≤ —Å—Ç—Ä–æ–∫–∞—Ö PostUp –∏ PostDown –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ —Ä–∞–∑ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `eth0`. –ï—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–æ–π ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ `eth0` –Ω–∞ –≤–∞—à.

–í—Å—Ç–∞–≤–ª—è–µ–º –≤–º–µ—Å—Ç–æ `<privatekey>` —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/etc/wireguard/privatekey`.

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º IP —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥:

```bash
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
sysctl -p
```

–í–∫–ª—é—á–∞–µ–º `systemd` –¥–µ–º–æ–Ω —Å `wireguard`:

```bash
systemctl enable wg-quick@wg0.service
systemctl start wg-quick@wg0.service
systemctl status wg-quick@wg0.service
```

–°–æ–∑–¥–∞—ë–º –∫–ª—é—á–∏ –∫–ª–∏–µ–Ω—Ç–∞:

```bash
wg genkey | tee /etc/wireguard/goloburdin_privatekey | wg pubkey | tee /etc/wireguard/goloburdin_publickey
```

–î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞:

```bash
vim /etc/wireguard/wg0.conf
```

```
[Peer]

PublicKey = <goloburdin_publickey>
AllowedIPs = 10.0.0.2/32
```

–í–º–µ—Å—Ç–æ `<goloburdin_publickey>`¬† ‚Äî –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/etc/wireguard/goloburdin_publickey`.
`
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º `systemd` —Å–µ—Ä–≤–∏—Å —Å `wireguard`:

```bash
systemctl restart wg-quick@wg0
systemctl status wg-quick@wg0
```

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ) —Å–æ–∑–¥–∞—ë–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫–æ–Ω—Ñ–∏–≥–æ–º –∫–ª–∏–µ–Ω—Ç–∞:

```bash
vim goloburdin_wb.conf
```


```
[Interface]

PrivateKey = <CLIENT-PRIVATE-KEY>
Address = 10.0.0.2/32
DNS = 8.8.8.8

[Peer]

PublicKey = <SERVER-PUBKEY>
Endpoint = <SERVER-IP>:51830
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 20
```

–ó–¥–µ—Å—å `<CLIENT-PRIVATE-KEY>` –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞, —Ç–æ –µ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/etc/wireguard/goloburdin_privatekey` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.¬† `<SERVER-PUBKEY>` –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞, —Ç–æ –µ—Å—Ç—å –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/etc/wireguard/publickey` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. `<SERVER-IP>` –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞.¬†

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ Wireguard –∫–ª–∏–µ–Ω—Ç–µ (–µ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –≤ —Ç–æ–º —á–∏—Å–ª–µ –º–æ–±–∏–ª—å–Ω—ã—Ö) ‚Äî –∏ –∂–º–µ–º –≤ –∫–ª–∏–µ–Ω—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.



----
üìÇ [[Tooling]] | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: 20.08.2024 08:00